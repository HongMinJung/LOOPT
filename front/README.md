# **📌 스터디 플랫폼 전체 기능 및 추가 고려사항 흐름도**

---

## **1️⃣ 회원가입 & 로그인**

### **프로세스**
- **회원가입**
    - 사용자가 이메일/비밀번호 또는 소셜 로그인 방식으로 회원가입 시도
    - **이메일 인증 필수** (인증 코드 발송 및 확인)  
      _추가 기능: 비밀번호 찾기, 프로필 수정_
    - Spring Boot에서 입력값 검증 후, Supabase의 `users` 테이블에 사용자 정보 저장

- **로그인**
    - 로그인 시 Spring Boot에서 JWT 발급 → Next.js 클라이언트에서 인증 유지

### **Supabase `users` 테이블 예시**
```
| user_id | email            | password   | nickname | profile_img  | created_at  |
|---------|------------------|------------|----------|--------------|-------------|
| 1       | user@example.com | hashed_pw  | User1    | profile1.png | 2025-02-25  |
```

---

## **2️⃣ 스터디방 생성 & 관리**

### **프로세스**
- 사용자가 스터디방 생성 버튼 클릭
- **이용 약관 동의 필수**  
  (불법 행위, 손해배상 책임 등 명시 – 동의 여부를 기록하여 보관)
- 방 정보 입력  
  (방 제목, 공개/비공개 여부, 최대 인원 등)
- **추가 기능**:
    - 초대 링크 생성 (비공개 방 지원)
    - 비밀번호 설정
    - 방 신고 기능 및 관리 페이지 연동

- Spring Boot에서 방 정보를 검증 후, Supabase의 `study_rooms` 테이블에 저장

### **Supabase `study_rooms` 테이블 예시**
```
| room_id | room_name         | owner_id | is_private | agreement_accepted | created_at  |
|---------|-------------------|----------|------------|--------------------|-------------|
| 101     | 알고리즘 스터디    | 1        | true       | true               | 2025-02-25  |
```

---

## **3️⃣ 스터디방 내 기능**

### **(A) 실시간 채팅 (WebSocket + Redis + Supabase)**

1. **채팅 접속**
    - 사용자가 스터디방 입장 → Next.js 클라이언트가 WebSocket 서버에 연결

2. **메시지 전송 및 필터링**
    - 사용자가 메시지 전송 → WebSocket 서버에서 수신
    - **실시간 필터링 처리**
        - 서버에서 `bad-words`와 같은 라이브러리를 활용하여 메시지 내 금지어/비속어 검사
    - **분기 처리**
        - **정상 메시지**
            - 메시지를 Redis에 저장 (TTL 1시간 적용)
            - Redis Pub/Sub을 통해 해당 스터디방의 다른 사용자에게 전달
            - 백그라운드 워커가 일정 시간이 지난 후 Redis의 메시지를 Supabase에 영구 저장
        - **부적절한 메시지**
            - 메시지 전송을 차단하고, 사용자에게 경고 메시지 전달
            - 해당 사용자의 경고 횟수를 기록(예: `warning_count` 증가)
                - 누적 경고 횟수가 기준(예: 3회 이상)이 되면
                    - 사용자를 강제 차단하거나 채팅방에서 강퇴
                    - 일정 시간 동안 재접속 제한 처리

3. **추가 기능**
    - 이미지 및 파일 업로드 지원
    - 채팅 메시지 신고 기능 (운영자 검토 및 후속 조치)

---

### **(B) 공지사항 관리**

1. 방장이 공지사항 작성 → Spring Boot를 통해 Supabase에 저장
2. 스터디방 멤버들은 공지사항 조회 가능
3. **추가 기능**
    - 중요 공지 고정 노출
    - 댓글 기능 추가
    - 공지 등록 시 푸시/이메일 알림

---

### **(C) 출석 체크 시스템**

1. 사용자가 "출석 체크" 버튼 클릭
2. Spring Boot가 출석 정보를 Supabase에 기록
3. 출석률 및 통계 제공 (그래프, 연속 출석 보너스 등)
4. **추가 기능**
    - 지각/결석 구분 기능

---

## **4️⃣ 최종 텍스트 기반 흐름도**

```plaintext
[회원가입/로그인]
    ├── 사용자가 입력 (이메일/비밀번호, 소셜 로그인)
    ├── 이메일 인증 필수 (인증 코드 확인)
    ├── Spring Boot 검증 → Supabase (users 테이블 저장)
    └── 로그인 시 JWT 발급 → Next.js에서 인증 유지

[스터디방 생성 및 관리]
    ├── 사용자 클릭: 스터디방 생성
    ├── 이용 약관 동의 필수 (불법 행위, 손해배상 책임 명시; 동의 기록 저장)
    ├── 방 정보 입력 (제목, 공개/비공개, 최대 인원)
    ├── 초대 링크 생성 및 비밀번호 설정 (비공개 방 지원)
    └── Spring Boot 검증 → Supabase (study_rooms 테이블 저장)

[스터디방 내 기능]
    ├── [실시간 채팅]
    │      ├── 사용자가 스터디방 입장 → Next.js 클라이언트가 WebSocket 서버 연결
    │      ├── 사용자가 메시지 전송 → WebSocket 서버 수신
    │      ├── 서버: 메시지 필터링 (비속어/금지어 검사)
    │      │        ├── [정상 메시지]
    │      │        │       ├── Redis에 메시지 저장 (TTL 1시간)
    │      │        │       ├── Redis Pub/Sub 통해 다른 사용자에게 전달
    │      │        │       └── 백그라운드 워커가 일정 시간 후 Supabase에 저장
    │      │        └── [부적절한 메시지]
    │      │                ├── 메시지 전송 차단 및 경고 메시지 전달
    │      │                ├── 사용자 경고 횟수 증가 (warning_count 업데이트)
    │      │                └── (경고 횟수 >= 기준) → 사용자 강제 차단/채팅방 강퇴, 재접속 제한 안내
    │      └── 추가: 파일 업로드, 신고 기능
    │
    ├── [공지사항]
    │      ├── 방장이 공지사항 작성 → Spring Boot 통해 Supabase 저장
    │      └── 멤버들이 조회 (중요 공지 고정, 댓글/알림 기능 추가)
    │
    └── [출석 체크]
           ├── 사용자가 출석 체크 버튼 클릭
           ├── Spring Boot → Supabase에 출석 정보 저장
           └── 출석률 및 통계 제공 (연속 출석 보너스, 지각/결석 구분)
```

---

## **5️⃣ 추가 고려사항**

- **권한 관리**
    - 방장, 운영진, 일반 멤버 역할 구분 및 접근 제어
    - 각 역할에 따른 기능 사용 제한 (예: 공지사항 수정, 채팅 관리 등)

- **보안 강화**
    - JWT 토큰 검증 및 API Rate Limit 적용
    - WebSocket 연결 시 인증 및 암호화(SSL/TLS) 처리
    - 데이터베이스와 Redis 간의 보안 연결(예: SSL 인증)

- **서버 확장성 및 로드 밸런싱**
    - WebSocket 서버가 여러 대인 경우, Redis Pub/Sub 및 로드 밸런서를 통한 확장
    - 트래픽 폭주에 대비한 자동 스케일링 정책 마련

- **로그 및 모니터링**
    - 채팅 메시지 필터링, 경고 및 차단 내역을 로그로 기록
    - 관리자 대시보드에서 실시간 모니터링, 사용자 신고 및 처리 내역 확인
    - 시스템 성능, 에러 로그 등을 모니터링하여 빠른 대응

- **유지보수 및 동적 설정**
    - 금지어 리스트 및 필터링 정책을 동적으로 업데이트할 수 있는 관리 페이지 제공
    - 사용자 피드백을 반영하여 UI/UX 개선 및 정책 변경 가능하도록 설계

- **사용자 경험(UX) 개선**
    - 경고 메시지, 차단 안내 및 재접속 제한에 대한 직관적인 UI 제공
    - 공지사항, 출석 체크, 초대 링크 등 각 기능에 대해 사용자가 쉽게 이해하고 사용할 수 있도록 설계

---

이 흐름도는 스터디 플랫폼의 각 기능(회원가입, 스터디방 생성/관리, 실시간 채팅, 공지사항, 출석 체크)과 함께  
부적절한 메시지 필터링, 경고 및 차단 로직, 그리고 보안·확장성·로그/모니터링 등 운영 시 고려해야 할 사항들을 모두 포함하고 있어.

이런 구조라면, 서비스 안정성과 사용자 경험, 그리고 관리 측면에서도 효과적인 플랫폼 구축이 가능할 거야.  
추가로 더 필요한 부분이나 수정할 내용이 있으면 알려줘!

### **📌 메인 페이지 기능 추가 및 개선**
✅ **1. 공지사항 (운영진/관리자 전용)**
- 운영진이 중요한 공지를 올릴 수 있도록 관리 페이지 제공
- 공지사항 목록을 메인 페이지 상단 또는 별도 섹션에 표시
- 최신 공지사항을 **Firebase Firestore 또는 Supabase**에 저장 후 실시간 업데이트
- **추가 기능**: 공지사항에 댓글 기능 추가 (Q&A 방식)

✅ **2. 인기 있는 스터디방**
- **기준 설정**:
    - 최근 일주일간 가장 활발한 채팅방
    - 가장 많은 멤버가 참여한 방
    - 높은 참여율을 기록한 방
- Supabase에서 **조회수 & 참여도 기반 랭킹**을 계산해 인기 스터디방 목록 노출
- **추가 기능**: 사용자 맞춤 추천 (관심 태그 기반 추천)

✅ **3. 스터디방 검색 (필터링 및 정렬 포함)**
- 검색 바를 통해 **스터디방을 제목, 태그, 카테고리 기반으로 필터링**
- 검색 결과를 정렬하는 옵션 제공 (예: 최신순, 인기순, 인원 많은 순)
- Next.js에서 **Debounce 기법**을 적용하여 **실시간 검색** 성능 최적화
- **추가 기능**: 검색 결과에 **스터디방 미리보기** (설명, 현재 참여자 수, 비공개 여부 등)

---

### **📌 메인 페이지 최종 구성**
| 섹션 | 설명 |
|------|------|
| 🔔 공지사항 | 운영진이 올린 최신 공지사항 표시 |
| 🔥 인기 스터디방 | 최근 인기 있는 스터디방 리스트 (조회수/참여도 기준) |
| 🔍 스터디방 검색 | 제목, 태그, 카테고리별 필터링 및 정렬 기능 지원 |

이렇게 추가하면 **메인 페이지에서 사용자들이 더 쉽게 원하는 스터디방을 찾고, 플랫폼의 활동성을 높일 수 있을 거야!**

### **📌 추가할 만한 기능 아이디어**
현재 생각한 기능도 굉장히 좋아! 특히 **"번개 모임(실시간 스터디 모임)"** 같은 기능은 사용자의 참여율을 높이는 데 효과적일 거야.  
아래 몇 가지 추가 기능을 추천해볼게.

---

## **1️⃣ 번개 모임 (실시간 스터디 매칭) → ✅ 강력 추천!**
> **설명:** 사용자가 즉시 참여할 수 있는 **즉석 스터디 모임(번개 모임)** 기능  
> **목표:** 즉시 참여할 수 있는 짧은 온라인/오프라인 스터디를 생성 & 매칭

### **📌 기능 상세**
✅ **모임 생성**
- 사용자가 **즉시 참여할 수 있는 스터디방**을 개설 (ex: "1시간 동안 알고리즘 문제 풀기")
- 비공개/공개 여부 선택, 최대 참여 인원 설정
- 위치 기반 기능 추가 시 **근처 오프라인 스터디**도 모집 가능

✅ **모임 참여**
- 다른 사용자는 "참여하기" 버튼을 눌러 즉시 참여
- 10분 동안 인원이 다 차지 않으면 자동 종료
- 참가한 멤버는 **음성 채팅(WebRTC) 또는 화상회의(Zoom API)** 를 이용 가능

✅ **추가 기능**
- **타이머 기능** → 1시간 동안 집중 스터디 후 자동 종료
- **스터디 종료 후 피드백 기록** → 다음 모임 개선

---

## **2️⃣ 랭킹 시스템 & 뱃지 보상**
> **설명:** 활동량과 성취도를 반영한 **사용자 랭킹 시스템**  
> **목표:** 사용자들의 지속적인 스터디 참여 유도

### **📌 기능 상세**
✅ **경험치 시스템**
- 출석 체크, 채팅 참여, 스터디방 개설, 번개 모임 참여 시 경험치(EXP) 지급
- 일정 경험치를 획득하면 레벨 상승

✅ **뱃지 보상**
- "3일 연속 출석" → **꾸준함 뱃지**
- "10개 이상의 스터디방 참가" → **열정 뱃지**
- "스터디방 개설 5회 이상" → **리더 뱃지**

✅ **추가 기능**
- 사용자 프로필에 랭킹 & 보유 뱃지 표시
- 활동량이 높은 사용자는 메인 페이지에 추천

---

## **3️⃣ 스터디 일정 관리 & 캘린더 기능**
> **설명:** 스터디 진행을 위해 일정 관리 기능 추가  
> **목표:** 스터디 일정 공유 & 알림 기능 제공

### **📌 기능 상세**
✅ **스터디 일정 등록**
- 스터디 리더가 일정(날짜/시간) 설정 가능
- 모든 멤버에게 알림 전송

✅ **출석 체크**
- 일정 시작 후 "출석 체크" 버튼 클릭 가능
- 일정에 참석한 멤버는 **출석 포인트** 지급
- 출석률이 낮은 사용자는 알림 제공

✅ **추가 기능**
- Google Calendar 연동
- 일정 시작 10분 전에 **알림 푸시 기능**

---

## **4️⃣ AI 기반 스터디 추천**
> **설명:** 사용자의 관심사 & 학습 이력을 기반으로 **추천 스터디 제공**  
> **목표:** 사용자 맞춤형 학습 경험 제공

### **📌 기능 상세**
✅ **추천 방식**
- 사용자의 **참여 이력, 검색 기록, 관심 태그** 기반으로 AI 추천
- 인기 있는 스터디방 중 **유사한 관심사를 가진 사용자들이 참여한 방** 추천

✅ **추가 기능**
- "이런 스터디는 어때요?" → 추천 리스트 표시
- 참여한 스터디와 유사한 다른 스터디 자동 추천

---

### **📌 정리: 추가 기능 목록**
| 기능 | 설명 |
|------|------|
| 🏃 번개 모임 | 즉시 참여 가능한 실시간 스터디 매칭 |
| 🏆 랭킹 & 뱃지 시스템 | 활동량에 따라 경험치 & 보상 지급 |
| 📅 스터디 일정 관리 | 일정 공유, 출석 체크, 알림 기능 |
| 🤖 AI 기반 추천 | 사용자 맞춤형 스터디 추천 |




아래는 지금까지 논의한 모든 내용을 포함한 **스터디 플랫폼의 최종 플로우(흐름도) 정리**야.  
각 기능을 논리적으로 연결하고, **추가 고려 사항**도 포함했어.

---

# **📌 스터디 플랫폼 최종 플로우 (Flow)**
> **사용 기술:**
> - **Frontend:** Next.js, Tailwind CSS, WebSocket (실시간 기능)
> - **Backend:** Spring Boot, Supabase (DB), Redis (실시간 데이터 처리)
> - **지도 기능:** Google Maps API / Mapbox / Leaflet.js

---

## **1️⃣ 회원가입 & 로그인**

### **📌 프로세스**
1. 사용자가 이메일/비밀번호 또는 소셜 로그인으로 가입 시도
2. **이메일 인증 필수** (인증 코드 발송 & 확인)
3. Spring Boot에서 데이터 검증 후, Supabase `users` 테이블에 저장
4. 로그인 성공 시 **JWT 발급 → Next.js 클라이언트에서 인증 유지**

### **📌 추가 고려 사항**
- 소셜 로그인(Google, Kakao) 지원
- **닉네임, 프로필 이미지 설정**
- **활동 기록 기반 랭킹 시스템 적용**

---

## **2️⃣ 메인 페이지 구성**

### **📌 주요 기능**
✅ **공지사항** → 운영진이 등록한 공지 표시  
✅ **인기 스터디방** → 활동량이 많은 스터디방 랭킹 표시  
✅ **스터디방 검색** → 제목, 태그, 카테고리 기반 필터링 및 정렬

### **📌 추가 고려 사항**
- AI 기반 **사용자 맞춤 스터디방 추천 기능**
- 최근 접속한 스터디방 목록 표시

---

## **3️⃣ 스터디방 생성 & 관리**

### **📌 프로세스**
1. 사용자가 **스터디방 생성 버튼 클릭**
2. **스터디방 이용 약관 동의 필수** (불법 행위, 손해배상 책임 등)
3. 방 정보 입력 (방 제목, 공개/비공개, 최대 인원 등)
4. 초대 링크 자동 생성 & 비밀번호 설정 가능
5. Supabase `study_rooms` 테이블에 방 정보 저장

### **📌 추가 고려 사항**
- 비공개 스터디방 초대 기능
- **스터디방 신고 기능** (운영진이 확인 후 조치)

---

## **4️⃣ 실시간 채팅 (WebSocket + Redis + Supabase)**

### **📌 프로세스**
1. 사용자가 스터디방에 입장하면 WebSocket 연결
2. 채팅 메시지 입력 시 **비속어 필터링** 후 메시지 저장
3. 1시간 동안 **Redis에 캐싱** 후 Supabase에 영구 저장

### **📌 추가 기능**
✅ **비속어 감지 및 경고 시스템**  
✅ **3회 이상 경고 시 자동 강퇴**  
✅ **공지/중요 메시지 고정 기능**

---

## **5️⃣ 실시간 지도 기반 기능 추가**

### **📌 (A) 실시간 사용자 히트맵 (Heatmap)**
1. 사용자가 로그인하면 **위치 정보 수집 (선택적 동의)**
2. WebSocket을 통해 사용자 좌표를 **Redis에 저장 & 실시간 업데이트**
3. 지도에서 사용자 밀도가 높은 지역을 히트맵으로 표시

### **📌 (B) 스터디방 멤버 지도 표시**
1. 사용자가 스터디방 입장 시 **위치 공유 여부 선택 가능**
2. 위치 공유 허용한 멤버만 지도에 표시
3. 같은 지역 멤버를 클릭하면 **"번개 모임 제안" 가능**

✅ **추가 고려 사항**
- 방장이 특정 위치를 클릭해 **오프라인 모임 제안 가능**
- 비공개 모드 지원 (원하면 위치 숨김)

---

## **6️⃣ 번개 모임 (즉석 스터디 모임 매칭) → ✅ 핵심 추가 기능!**

### **📌 프로세스**
1. 사용자가 **"번개 모임 생성" 버튼 클릭**
2. 스터디 주제, 시간 설정 (예: "1시간 알고리즘 문제 풀이")
3. 실시간으로 참가자 모집 (정원이 차면 자동 시작)
4. **WebRTC(음성/화상 채팅) 또는 실시간 채팅으로 스터디 진행**
5. 타이머 종료 후 자동 모임 종료

✅ **추가 기능**
- 타이머 기능 (ex: 1시간 집중 스터디 후 자동 종료)
- **스터디 종료 후 피드백 기록**

---

## **7️⃣ 랭킹 시스템 & 보상 기능**
> **사용자의 스터디 활동을 반영한 랭킹 시스템**

### **📌 기능 상세**
✅ **경험치 시스템 (EXP)**
- 채팅 참여, 출석 체크, 스터디방 개설 시 경험치 지급
- 일정 경험치 달성 시 레벨 업

✅ **뱃지 보상 시스템**
- "3일 연속 출석" → **꾸준함 뱃지**
- "10개 이상의 스터디방 참가" → **열정 뱃지**
- "스터디방 개설 5회 이상" → **리더 뱃지**

✅ **추가 고려 사항**
- 랭킹 페이지에 **최상위 유저 리스트 표시**
- 뱃지를 보상으로 제공하여 **스터디 참여 유도**

---

## **📌 최종 정리 (추가 고려 사항 포함)**

### ✅ **추가 고려할 기능들**
| 기능 | 설명 |
|------|------|
| 🔥 실시간 사용자 히트맵 | 현재 접속 중인 사용자 분포를 지도에서 시각화 |
| 📍 스터디방 멤버 지도 표시 | 스터디방 내 멤버들의 위치 공유 (선택 가능) |
| ⚡ 번개 모임 | 즉석 스터디 모임 개설 및 실시간 매칭 |
| 🏆 랭킹 시스템 | 경험치(EXP) 기반 사용자 랭킹 & 뱃지 보상 |
| 🔔 공지사항 | 운영진이 최신 공지를 게시 & 댓글 기능 지원 |
| 📊 인기 스터디방 | 활동량 기준 인기 스터디방 자동 추천 |
| 🔍 스터디방 검색 | 제목, 태그, 카테고리 필터링 및 정렬 지원 |

---

다음은 프로젝트의 전체 플로우를 정리한 README입니다.

로그인 시 세션 관리 방식은 선택한 **인증 방법**에 따라 다릅니다. 아래에 주요한 두 가지 인증 방식을 설명드리겠습니다.

---

## **1️⃣ JWT (JSON Web Token) 기반 인증** (권장)

**📌 동작 방식:**

1.사용자가 **로그인 요청**을 보내면, Spring Boot 백엔드에서 사용자를 검증합니다
2.인증에 성공하면 **JWT**를 생성하여 프론트엔드(Next.js)로 반환합니다
3.프론트엔드는 이 JWT를 **쿠키** 또는 **로컬 스토리지**에 저장합니다
4.이후 요청 시, JWT를 **Authorization 헤더**에 포함하여 백엔드로 전송합니다
5.백엔드는 전달받은 JWT를 검증하여 사용자를 식별합니다

**📌 Redis 사용 여부:**

**필수 아님**: JWT는 자체적으로 사용자 정보를 포함하므로, 서버 측 세션 저장소가 필요하지 않습니
**선택적 사용**: 로그아웃 시 토큰을 무효화하거나, 토큰 블랙리스트를 관리하기 위해 Redis를 활용할 수 있습니

**📌 예시 코드:**

- **Spring Boot*: JWT 생성 및 검증 로직현
- **Next.js*: 로그인 시 JWT를 받아 쿠키에 저장하고, 요청 시 해당 토큰을 포함하여송

---

## **2️⃣ 세션 기반 인증 (Spring Session + Redis)**

**📌 동작 방식:**
1. 사용자가 **로그인 요청